{% if pages %}
{% for page in pages %}
<tr class="border-b {% if loop.last %}mb-32 pb-32{% endif %}">
    <th class="w-1/12">
        <label>
            <input type="checkbox" class="checkbox rounded-none h-4 w-4" name="selected_pages" value="{{ page.id }}" />
        </label>
    </th>
    <td class="w-4/12 pl-6 md:pl-2 md:pr-4 md:pt-2">
        <div class="flex items-center">
            <div>
                <div class="ml-1 md:ml-0 font-medium text-sm leading-3 md:leading-none mb-1 mt-1 md:mt-1">{{ page.nombre }}</div>
                <div class="ml-1 md:ml-0 text-xs opacity-50 mb-2 leading-none">{{ page.país }}</div>
            </div>
        </div>
        <input type="hidden" name="name_{{ page.id }}" value="{{ page.nombre }}">
        <input type="hidden" name="country_{{ page.id }}" value="{{ page.país }}">
        <input type="hidden" name="url_{{ page.id }}" value="{{ page.url }}">
        <input type="hidden" name="recipients_{{ page.id }}" value="{{ page.destinatarios }}">
        <input type="hidden" name="fecha_de_cierre_{{ page.id }}" value="{{ page.fecha_de_cierre }}">
    </td>
    <td class="w-3/12 p-2 relative">
        <div class="border-left-custom text-sm md:px-2 pl-4 md:pl-8 py-2 capitalize-first h-12 flex items-center" style="line-height: 0.8rem;">
            {{ (page.ai_keywords | truncate(27)).capitalize() }}
        </div>
    </td>
    <td class="w-2/12 text-xs p-2 md:p-0 relative md:right-2 fecha-de-cierre">
        {{ page.fecha_de_cierre | default("Sin cierre") | format_date }}
    </td>
    <th class="w-1/12 p-2 static">
        <div class="flex items-center gap-1 bg-slate-100 p-2">
            <div role="button"
               tabindex="0"
               data-url="{{ page.url }}"
               data-keywords="{{ page.ai_keywords }}"
               data-name="{{ page.nombre }}"
               data-country="{{ page.país }}"
               class="opportunity-link btn btn-ghost btn-xs p-1 cursor-pointer">
                <svg class="w-4" data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5L19.5 4.5M19.5 4.5H8.25M19.5 4.5V15.75"></path>
                </svg>
            </div>
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-xs p-1">
                    <svg class="w-4" data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor"
                        viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z">
                        </path>
                    </svg>
                </label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a href="#"
                            onclick="shareOpportunity('{{ page.url }}', '{{ page.nombre }}', 'whatsapp')">WhatsApp</a>
                    </li>
                    <li><a href="#"
                            onclick="shareOpportunity('{{ page.url }}', '{{ page.nombre }}', 'linkedin')">LinkedIn</a>
                    </li>
                    <li><a href="#" onclick="shareOpportunity('{{ page.url }}', '{{ page.nombre }}', 'gmail')">Email</a>
                    </li>
                </ul>
            </div>
        </div>
    </th>
</tr>
{% endfor %}
{% else %}
<tr>
    <td colspan="5" class="p-2 mb-2">No se encontró nada relevantes.</td>
</tr>
{% endif %}

<style>
    .border-left-custom {
            position: relative;
        }

        .border-left-custom::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background-color: #e5e7eb;
        }

        .capitalize-first::first-letter {
            text-transform: uppercase !important;
        }

    tr:last-child {
        margin-bottom: 8rem !important;
    }
    
    #search-results {
        padding-bottom: 8rem;
    }

    .fecha-de-cierre {
        text-align: center;
    }

    .fecha-de-cierre.confirmar {
        padding-left: 6px; /* Adjusts the text slightly to the right */
    }
</style>

<script>
    function shareOpportunity(url, title, platform) {
        const encodedUrl = encodeURIComponent(url);
        const encodedTitle = encodeURIComponent('\n- 100 ︱ Oportunidades');

        let shareUrl = '';

        if (platform === 'whatsapp') {
            shareUrl = `https://wa.me/?text=${encodedTitle}%20${encodedUrl}`;
        } else if (platform === 'linkedin') {
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}&text=${encodedTitle}`;
        } else if (platform === 'gmail') {
            shareUrl = `mailto:?subject=${encodeURIComponent(encodedTitle)}&body=${encodedUrl}`;
        }
        window.open(shareUrl, '_blank');
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.fecha-de-cierre').forEach(function (element) {
            if (element.textContent.trim() === 'Sin Cierre') {
                element.textContent = 'Confirmar';
                element.classList.add('confirmar'); // Add class to apply specific styles
            }
            // Ensure all fecha-de-cierre elements are centered
            element.classList.add('text-center');
        });
    });
</script>
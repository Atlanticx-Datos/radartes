{% extends 'layout.html' %}

{% block body %}
<body>
    <main class="w-full max-w-[1250px] mx-auto mt-2">
        <div class="grid grid-cols-1 lg:grid-cols-6 gap-0">
            <!-- First Column: Accordions -->
            <div class="col-span-1 lg:col-span-2 mt-2 lg:mt-0 border-r border-neutral flex flex-col justify-between">
                <div class="flex flex-col gap-3">
                    <!-- Accordion 1 -->
                    <div class="join join-vertical w-full">
                        <div class="collapse join-item border-b border-neutral rounded-none">
                            <input type="radio" name="my-accordion-1" checked="" />
                            <div class="collapse-title text-sm tracking-tighter text-neutral-700">
                                CIERRAN PRONTO
                            </div>
                            <div class="collapse-content">
                                {% if closing_soon_pages %}
                                {% for page in closing_soon_pages %}
                                <p class="relative">
                                    <a href="{{ page.url }}" target="_blank"
                                        class="border-l-4 pl-4 mb-3 block leading-none tracking-tighter group md:w-5/6 truncate">
                                        {{ page.nombre }}
                                        <span
                                            class="absolute right-0 top-1/2 transform -translate-y-1/2 flex items-center justify-center -mr-1">
                                            <span
                                                class="flex items-center justify-center group-hover:bg-slate-200 group-hover:rounded-md transition-all duration-200 p-2">
                                                <svg class="w-3 h-3 z-10" data-slot="icon" fill="none" stroke-width="1.5"
                                                    stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                                    aria-hidden="true">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="m4.5 19.5 15-15m0 0H8.25m11.25 0v11.25"></path>
                                                </svg>
                                            </span>
                                        </span>
                                    </a>
                                </p>
                                {% endfor %}
                                {% else %}
                                <p>No hay oportunidades este mes.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <!-- Accordion 2 -->
                    <div class="join join-vertical">
                        <div class="collapse join-item border-neutral rounded-none">
                            <input type="radio" name="my-accordion-2" checked="" />
                            <div class="collapse-title text-sm tracking-tighter text-neutral-700">
                                DESTACADAS
                            </div>
                            <div class="collapse-content" style="max-width: 403px;"> 
                                {% if empty_fecha_pages %}
                                {% for page in empty_fecha_pages %}
                                <div class="relative">
                                    <a href="{{ page.url }}" target="_blank"
                                        class="border-l-4 pl-4 mb-3 block leading-none tracking-tighter group truncate">
                                        {{ page.nombre }}
                                        <span
                                            class="absolute right-0 top-1/2 transform -translate-y-1/2 flex items-center justify-center -mr-2">
                                            <span
                                                class="flex items-center justify-center group-hover:bg-slate-200 group-hover:rounded-md transition-all duration-200 p-2">
                                                <svg class="w-3 h-3 z-10" data-slot="icon" fill="none" stroke-width="1.5"
                                                    stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                                    aria-hidden="true">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="m4.5 19.5 15-15m0 0H8.25m11.25 0v11.25"></path>
                                                </svg>
                                            </span>
                                        </span>
                                    </a>
                                </div>
                                {% endfor %}
                                {% else %}
                                <p>No estamos destacando.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Search Input -->
                <div class="flex items-center relative">
                    <input type="text" id="search-input" placeholder="Buscar oportunidades"
                        class="input input-bordered rounded-none w-full pl-6 lg:ml-0 focus:ring-0 focus:ring-offset-0 focus:ring-inset md:border-r-0"
                        name="search" onkeypress="handleKeyPress(event)">
                    <div class="absolute right-2 top-1/2 transform -translate-y-1/2 cursor-pointer" onclick="clearSearch()">
                        <svg class="w-4 h-4" fill="none" stroke-width="1.5" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Second Column: Table -->
            <div class="col-span-1 lg:col-span-3 mt-2 lg:mt-0 border-r border-neutral">
                <form id="save-form" hx-post="/save_user_opportunity" hx-trigger="submit" hx-swap="innerHTML"
                            hx-target="#alert-container">
                    <div class="border-b border-neutral overflow-auto" style="max-height: 35rem;">
                        <style>
                            ::-webkit-scrollbar {
                                width: 0;
                                height: 0;
                            }
                        </style>
                        <table id="search_results" class="table-fixed w-full">
                            <thead>
                                <tr>
                                    <th class="1/12 text-center flex justify-center"></th>
                                    <th class="w-7/12 md:w-4/12 text-left ml-3 md:ml-0 font-bold bg-black py-0 px-2 text-white">100 ï¸± Oportunidades</th>
                                    <th class="w-3/12 text-left pl-2"></th>
                                    <th class="w-2/12 text-left pl-6"></th>
                                    <th class="text-left"></th>
                                </tr>
                            </thead>
                            <tbody id="search-results" class="relative top-4">
                                {% include "_search_results.html" %}
                            </tbody>
                        </table>                                              
                    </div>
                    <div class="flex justify-center items-center space-x-2 mt-6 mb-4">
                        <div id="alert-container" class="flex items-center"></div>
                        <button type="submit" class="uppercase text-sm font-black tracking-tighter text-neutral-700">Guardar Seleccionados</button>
                    </div>
                </form>
            </div>

            <!-- Third Column: Empty Container -->
            <div class="col-span-1 lg:col-span-1 mt-2 lg:mt-0 flex flex-col border-neutral bg-accent">
                <div class="flex-1 border-b border-r border-t  border-black bg-secondary pb-36"></div>
                <div class="flex-1 border-r border-black"></div>
                <div class="flex justify-center relative top-16 animate-bounce">
                    <svg class="w-6 h-6" data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"></path>
                    </svg>
                </div>
            </div>
        </div>
    </main>

    <!-- Script for handling HTMX search -->
    <script>
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const searchValue = document.getElementById('search-input').value;
                console.log('Search Value:', searchValue);  // Debug log
                htmx.ajax('GET', '/database', { target: '#search-results', swap: 'innerHTML', values: { search: searchValue } });
            }
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            htmx.ajax('GET', '/database', { target: '#search-results', swap: 'innerHTML' });
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('search-input').addEventListener('keypress', handleKeyPress);

            const clearSearchButton = document.querySelector('.clear-search-button'); // Assuming you have a clear button with this class
            if (clearSearchButton) {
                clearSearchButton.addEventListener('click', clearSearch);
            }
        });
    </script>

    <!-- Debugging Network Requests -->
    <script>
        document.addEventListener('htmx:beforeRequest', (event) => {
            console.log('HTMX Request:', event.detail.elt, event.detail.target, event.detail.xhr);
        });

        document.addEventListener('htmx:afterOnLoad', (event) => {
            console.log('HTMX Response:', event.detail.elt, event.detail.target, event.detail.xhr);
        });

        document.addEventListener('htmx:beforeSwap', (event) => {
            console.log('HTMX Swap:', event.detail.elt, event.detail.target, event.detail.xhr);
        });

        document.addEventListener('htmx:afterSwap', (event) => {
            console.log('HTMX Swapped:', event.detail.elt, event.detail.target, event.detail.xhr);
        });
    </script>
</body>
{% endblock %}
